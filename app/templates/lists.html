{% extends "base.html" %}
{% block content %}
<h2>Mes listes</h2>
<form method="POST" action="{{ url_for('main.add_list') }}">
    <input type="text" name="name" placeholder="Nom de la liste" required>
    <input type="text" name="tag" placeholder="Tag (ex : groceries)" required>
    <div id="tag-suggestions"></div>
    <button type="submit">Ajouter</button>
</form>
<ul>
    {% for list in lists %}
    <li>
        <a href="{{ url_for('main.get_list', list_id=list.id) }}">
            {{ list.name }} <small>[{{ list.tag }}]</small>
        </a>
        <form method="POST" action="{{ url_for('main.delete_list', list_id=list.id) }}" style="display:inline">
            <button type="submit">üóëÔ∏è</button>
        </form>
    </li>
    {% endfor %}
</ul>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tagInput = document.querySelector('input[name="tag"]');
        const tagSuggestionsDiv = document.getElementById('tag-suggestions');
        let tagDebounceTimeout = null;

        if (tagInput) {
            tagInput.addEventListener('input', function () {
                const value = tagInput.value.trim();
                tagSuggestionsDiv.innerHTML = '';
                if (value.length < 3) return;

                if (tagDebounceTimeout) clearTimeout(tagDebounceTimeout);

                tagDebounceTimeout = setTimeout(() => {
                    fetch(`/tags/suggestions?q=${encodeURIComponent(value)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.suggestions.length > 0) {
                                tagSuggestionsDiv.innerHTML =
                                    '<ul style="border:1px solid #ccc; background:#fff; margin-top:2px; padding:5px;">' +
                                    data.suggestions.map(s =>
                                        `<li style="cursor:pointer;" onclick="document.querySelector('input[name=tag]').value='${s.replace(/'/g,"\\'")}';document.getElementById('tag-suggestions').innerHTML=''">${s}</li>`
                                    ).join('') +
                                    '</ul>';
                            }
                        });
                }, 300);
            });
        }
    });
</script>

{% endblock %}
